<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout :: head"></head>
<body>
<div th:replace="layout :: nav"></div>

<main class="container mt-4">
    <!-- Заголовок -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1><i class="fas fa-barcode"></i> Сканирование багажа</h1>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a th:href="@{/staff/dashboard}">Панель сотрудника</a></li>
                    <li class="breadcrumb-item"><a th:href="@{/staff/luggage}">Багаж</a></li>
                    <li class="breadcrumb-item active">Сканирование</li>
                </ol>
            </nav>
        </div>
        <div>
            <a th:href="@{/staff/luggage}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left"></i> Назад
            </a>
        </div>
    </div>

    <!-- Сообщения -->
    <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show mb-4" role="alert">
        <i class="fas fa-check-circle me-2"></i>
        <span th:text="${successMessage}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show mb-4" role="alert">
        <i class="fas fa-exclamation-circle me-2"></i>
        <span th:text="${errorMessage}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <!-- Сканер багажа -->
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="fas fa-camera"></i> Сканирование штрих-кода</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <!-- Эмуляция сканера -->
                    <div class="scanner-placeholder text-center p-5 bg-dark rounded mb-3">
                        <i class="fas fa-camera fa-4x text-light mb-3"></i>
                        <p class="text-light mb-0">Наведите камеру на штрих-код багажа</p>
                    </div>

                    <button class="btn btn-info w-100 mb-3" onclick="startCamera()">
                        <i class="fas fa-video"></i> Включить камеру
                    </button>

                    <button class="btn btn-secondary w-100" onclick="simulateScan()">
                        <i class="fas fa-mobile-alt"></i> Имитировать сканирование
                    </button>
                </div>

                <div class="col-md-6">
                    <!-- Форма ручного ввода -->
                    <form th:action="@{/staff/luggage/scan}" method="post">
                        <div class="mb-3">
                            <label for="manualBarcode" class="form-label">Штрих-код вручную:</label>
                            <input type="text" class="form-control" id="manualBarcode"
                                   name="barcode" placeholder="Введите штрих-код" required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Пассажир:</label>
                            <select class="form-select" name="passportNumber">
                                <option value="">Выберите пассажира</option>
                                <!-- В реальном приложении здесь будут пассажиры из базы -->
                                <option value="AB1234567">Иванов И.И. (AB1234567)</option>
                                <option value="CD7890123">Петров П.П. (CD7890123)</option>
                                <option value="EF3456789">Сидоров С.С. (EF3456789)</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Рейс:</label>
                            <select class="form-select" name="flightNumber">
                                <option value="">Выберите рейс</option>
                                <!-- В реальном приложении здесь будут рейсы из базы -->
                                <option value="SU1001">SU1001 (Москва → СПб)</option>
                                <option value="SU1003">SU1003 (Москва → Казань)</option>
                                <option value="SU1005">SU1005 (СПб → Минск)</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Вес багажа (кг):</label>
                            <input type="number" class="form-control" name="weight"
                                   min="1" max="50" value="20" required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Количество мест:</label>
                            <select class="form-select" name="luggageCount">
                                <option value="1">1 место</option>
                                <option value="2" selected>2 места</option>
                                <option value="3">3 места (доплата)</option>
                            </select>
                        </div>

                        <div class="alert alert-warning">
                            <small>
                                <i class="fas fa-exclamation-triangle"></i>
                                После сканирования багаж автоматически отмечается как сданный.
                            </small>
                        </div>

                        <button type="submit" class="btn btn-success w-100">
                            <i class="fas fa-check"></i> Зарегистрировать багаж
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Последние отсканированные -->
    <div class="card mt-4">
        <div class="card-header bg-success text-white">
            <h5 class="mb-0"><i class="fas fa-history"></i> Последние отсканированные</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-sm">
                    <thead>
                    <tr>
                        <th>Время</th>
                        <th>Штрих-код</th>
                        <th>Пассажир</th>
                        <th>Рейс</th>
                        <th>Вес</th>
                        <th>Статус</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>14:25</td>
                        <td><code>BG-241221-12345</code></td>
                        <td>Иванов И.И.</td>
                        <td>SU1001</td>
                        <td>18 кг</td>
                        <td><span class="badge bg-success">Зарегистрирован</span></td>
                    </tr>
                    <tr>
                        <td>14:20</td>
                        <td><code>BG-241221-67890</code></td>
                        <td>Петров П.П.</td>
                        <td>SU1003</td>
                        <td>12 кг</td>
                        <td><span class="badge bg-success">Зарегистрирован</span></td>
                    </tr>
                    <tr>
                        <td>14:15</td>
                        <td><code>BG-241221-54321</code></td>
                        <td>Сидоров С.С.</td>
                        <td>SU1001</td>
                        <td>25 кг</td>
                        <td><span class="badge bg-warning">Перевес</span></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</main>

<div th:replace="layout :: footer"></div>

<style>
    .scanner-placeholder {
        min-height: 300px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }
</style>

<script>
    // Эмуляция сканирования
    function simulateScan() {
        const barcodes = [
            'BG-241221-12345',
            'BG-241221-67890',
            'BG-241221-54321',
            'BG-241221-98765',
            'BG-241221-13579'
        ];

        const randomBarcode = barcodes[Math.floor(Math.random() * barcodes.length)];
        document.getElementById('manualBarcode').value = randomBarcode;

        // Автозаполнение других полей для демонстрации
        const flights = ['SU1001', 'SU1003', 'SU1005'];
        const randomFlight = flights[Math.floor(Math.random() * flights.length)];
        document.querySelector('select[name="flightNumber"]').value = randomFlight;

        alert('Сканирование имитировано. Штрих-код: ' + randomBarcode);
    }

    // Включение камеры (демо)
    function startCamera() {
        alert('В реальном приложении здесь будет включение камеры для сканирования QR/штрих-кодов.\n\nДля демонстрации используйте кнопку "Имитировать сканирование".');
    }

    // Автоматический фокус на поле штрих-кода
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('manualBarcode')?.focus();
    });
</script>
</body>
</html>